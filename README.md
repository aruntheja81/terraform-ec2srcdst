# terraform-ec2srcdst

Terraform module to disable the EC2 source destination check in an autoscaling group using lifecycle hooks and Lambda.

To keep things simple, this module uses autogenerated names for most of the resources it creates. To be able to better identify such resources, you can provide extra tags via the `var.tags` variable, which will be appended to all resources that support tagging.

This module will create the following:

- An autoscaling lifecycle hook on launching instances for each provided autoscaling group name
- A Lambda function to disable the source destination check for all launched instances
  - The Lambda function is limited to only the provided autoscaling groups via IAM
  - The Lambda function has broader permissions with `ec2:ModifyInstanceAttribute`, as that action can't be locked down to specific resources
- A CloudWatch log group for the Lambda function
- An IAM role for the lambda function
- All the glue to bind the Autoscaling group lifecycle hooks with the Lambda function

## Variables

| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| autoscaling\_group\_count | The number of autoscaling group names provided in `var.autoscaling_group_names` | string | n/a | yes |
| autoscaling\_group\_names | List of autoscaling group names to attach the lambda function to | list | n/a | yes |
| lambda\_log\_retention\_in\_days | Specifies the number of days you want to retain log events in the lambda function log group | string | `"30"` | no |
| tags | Map with additional tags to add to created resources | map | `<map>` | no |

## Outputs

| Name | Description |
|------|-------------|
| lambda\_cloudwatch\_log\_group\_name | Name of the created Cloudwatch log group for the Lambda function |
| lambda\_function\_name | Name of the created Lambda function |

## Example

```tf
module "disable_srcdstcheck" {
  source                  = "github.com/skyscrapers/terraform-ec2srcdst"
  autoscaling_group_names = ["some-autoscaling-group-name", "some-other-autoscaling-group-name"]

  tags = {
    foo = "bar"
  }
}
```
